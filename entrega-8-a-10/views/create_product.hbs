<div class="products-create-container">
    <h3>Ingreso de Producto</h3>
    <form id="form-product-save">
        <div class="field field-name">
            <label>Nombre</label>
            <input type="text" name="name" />
        </div>
        <div class="field field-price">
            <label>Precio</label>
            <input type="number" name="price" />
        </div>
        <div class="field field-thumbnail">
            <label>Thumbnail</label>
            <input type="text" name="thumbnail" />
        </div>
        <input class="button-submit" type="submit" value="Guardar" />
    </form>
    <label id="status"></label>
</div>

<script>
    const satus = document.getElementById('status');

    const getFormJSON = (form) => {
        const data = new FormData(form);
        return Array.from(data.keys()).reduce((result, key) => {
            result[key] = data.get(key);
            return result;
        }, {});
    };

    const send = async (to, method = 'GET', obj) => {
        const body = obj ? JSON.stringify(obj) : undefined;

        const response = await fetch(to, {
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            method,
            body
        })

        return await response.json();
    }

    const createProduct = async product => {
        const data = await send('/api/products/save', 'POST', product)
        return data.result;
    }

    document.getElementById('form-product-save').onsubmit = e => {
        e.preventDefault();

        satus.textContent = "guardando ...";
    
        const product = getFormJSON(e.target);
        
        createProduct(product).then(() => {
            satus.textContent = 'guardado';

            e.target.reset();

            const t = setTimeout(() => {
                satus.textContent = '';
                clearTimeout(t);
            }, 5000);
        });
    }
</script>